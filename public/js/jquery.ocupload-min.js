(function(e){e.fn.upload=function(t){t=e.extend({name:"file",enctype:"multipart/form-data",action:"",autoSubmit:true,onSubmit:function(){},onComplete:function(){},onSelect:function(){},params:{}},t);return new e.ocupload(this,t)};e.ocupload=function(t,n){var r=this;var i=(new Date).getTime().toString();var s=e("<iframe></iframe>",{id:"iframe"+i,name:"iframe"+i}).css({display:"none"});var o=e("<form></form>",{method:"post",enctype:n.enctype,action:n.action,target:"iframe"+i}).css({margin:0,padding:0});var u=t.css("cursor");var a=e("<input>",{class:"ocupload",name:n.name+"[]",multiple:"multiple",type:"file",accept:n.accept}).css({position:"absolute",display:"none",cursor:u,opacity:0});t.wrap("<div></div>");o.append(a);t.after(o);t.after(s);t.click(function(){a.click();return false});var f=t.parent().css({position:"relative",display:t.css("display"),overflow:"hidden",cursor:u,margin:0,padding:0});a.change(function(){r.onSelect(r.filename());if(r.autoSubmit){r.submit()}});e.extend(this,{autoSubmit:n.autoSubmit,onSubmit:n.onSubmit,onComplete:n.onComplete,onSelect:n.onSelect,filename:function(){return a.val()},params:function(t){t=t?t:false;if(t){n.params=e.extend(n.params,t)}else{return n.params}},name:function(e){e=e?e:false;if(e){a.attr("name",value)}else{return a.attr("name")}},action:function(e){e=e?e:false;if(e){o.attr("action",e)}else{return o.attr("action")}},enctype:function(e){e=e?e:false;if(e){o.attr("enctype",e)}else{return o.attr("enctype")}},set:function(t,n){function i(e,t){switch(e){case"name":r.name(t);break;case"action":r.action(t);break;case"enctype":r.enctype(t);break;case"params":r.params(t);break;case"autoSubmit":r.autoSubmit=t;break;case"onSubmit":r.onSubmit=t;break;case"onComplete":r.onComplete=t;break;case"onSelect":r.onSelect=t;break;default:throw new Error("[jQuery.ocupload.set] '"+e+"' is an invalid option.")}}n=n?n:false;if(n){i(t,n)}else{e.each(t,function(e,t){i(e,t)})}},submit:function(){var t=this.onSubmit();if(t)return;e(".ocupload-"+i,o).remove();e.each(n.params,function(t,n){o.append(e("<input>",{type:"hidden",name:t,value:n,"class":"ocupload-"+i}))});o.submit();s.unbind().load(function(){var t=document.getElementById(s.attr("name"));var n=e(t.contentWindow.document.body).text();r.onComplete(n)})}})}})(jQuery)